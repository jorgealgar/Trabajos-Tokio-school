<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tabla de imagenes</title>
    <style>
      table,
      td,
      tr {
        border: 1px solid black;
        border-collapse: collapse;
      }
    </style>
    <script>
      // Esperar a que el HTML carge
      window.addEventListener("load", () => {
        // Me dejo preparada la tabla donde insertarÃ© las fotos
        const table = document.getElementById("img-table");

        // Pido al API la las fotos con un GET
        const responsePromise = fetch(
          "https://jsonplaceholder.typicode.com/albums/1/photos"
        );

        const renderTable = (photos) => {
          // Recorto la lista de fotos a 20 items
          const photosRec = photos.slice(0, 20);

          const renderRow = (photo) => {
            // Fila
            const fila = table.insertRow();
            // Columna 1
            let columna1 = fila.insertCell();
            let textoCol1 = document.createTextNode(photo.albumId);
            columna1.appendChild(textoCol1);
            // Columna 2
            let columna2 = fila.insertCell();
            let textoCol2 = document.createTextNode(photo.title);
            columna2.appendChild(textoCol2);
            // Columna 3
            let columna3 = fila.insertCell();
            let imgCol3 = document.createElement("img");
            imgCol3.src = photo.url;
            columna3.appendChild(imgCol3);
            // Columna 4
            let columna4 = fila.insertCell();
            let textoCol4 = document.createTextNode(photo.id);
            columna4.appendChild(textoCol4);
            // Columna 5
            let columna5 = fila.insertCell();
            let button = document.createElement("button");
            button.innerHTML = "Remove";
            button.onclick = () => {
              fila.remove();
              const responsePromise = fetch(
                `https://jsonplaceholder.typicode.com/photos/${photo.id}`,
                {
                  method: "DELETE",
                }
              );
            };
            columna5.appendChild(button);
          };

          // Por cada una de las fotos, creo los elementos necesarios
          photosRec.forEach(renderRow);
        };

        const readJson = (response) => {
          const photosPromise = response.json();
          photosPromise.then(renderTable);
        };

        // Espero a tener la response
        responsePromise.then(readJson);
      });

      const newPhoto = () => {
        const promiseResponse = fetch(
          "https://jsonplaceholder.typicode.com/album/1/photos/",
          {
            method: "PUT",
            body: JSON.stringify({
              albumId: 1,
              title: "Jorge Algar",
              url: "https://cursos.com/wp-content/uploads/2021/04/academia-tokio-school.jpg",
              thumbnailUrl: null,
            }),
            headers: {
              "Content-type": "application/json; charset=UTF-8",
            },
          }
        );

        promiseResponse.then((response) => {
          const photoPromise = response.json();

          photoPromise.then((photo) => {
            console.log("New Photo: ", photo);
          });
        });
      };
    </script>
  </head>
  <body>
    <button onclick="newPhoto()">Nueva Foto</button>
    <table id="img-table"></table>
  </body>
</html>
